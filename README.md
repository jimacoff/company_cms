# Company Website  
Documentation for Company Website
  

## Setup Environments in MacOSX
 
* Setup Ruby and Rails
	* Install rbenv and necessary plugins
			
			$ brew install rbenv ruby-build rbenv-binstubs rbenv-gem-rehash
			
		* If you are using _prezto_ just include ruby module in _.zpreztorc_ file and all are set. If not, add the following line to the end of your _.bashrc_ or _.zshrc_
			
				if which rbenv > /dev/null; then eval "$(rbenv init -)"; fi
			
	* Install ruby (this project use version 2.1.0) 
	* Install necessary gems
	* Read more [here](http://linhmtran168.github.io/blog/2013/12/19/setting-mac-osx-for-ror-development/)
* Install required package and app
	* ImageMagick for handling image resize
				
			$ brew install ImageMagick
			
	* PostgresSQL
		* Install [Postgres.app](http://postgresapp.com/)
* Setup PostgresSQL user for development
	* Open Postgres.app, click it icon in Mac's menubar and choose open psql. The terminal will open psql command prompt
	* Use the following command to reate a new user with the right to login and create db 
			
			CREATE ROLE develop WITH login createdb password '123456';
			
## Initial project setup

* Install project's gem dependencies
			
			$ cd $project_path
			$ bundle install --no-binstubs # Configure bundle to not install binstubs

* Install necessary binstubs needed in development
			
			$ bundle binstub rspec-core guard thin capistrano spring
			
	* Because we installed the [rbenv-binstubs](https://github.com/ianheggie/rbenv-binstubs) plugin, we don't need to type ```bundle exec ...``` to use those binstub in our project folder anymore, just type their binstub name and the plugin will handle the rest
	
* Use ___spring___ to overrider main Rails' binstub (rails, rake, rspec...) to preload Rails environment so that server and test startup take shorter time
			
			$ spring binstub --all
			
* Setup initial database for development and test

			$ rake db:setup
			# The above command is the equavalent of the following commands
			$ rake db:create # create the databse as defined in config/database.yml
			$ rake db:migrate # migrate data
			$ rake db:seed # seed initial data if they are defined in db/seeds.rb
			# create the database and data for testing
			$ rake test:prepare 
			
* Run development server and test
			
			# Run server
			$ rails server # or rails s
			# Run test (not watching changes)
			$ rspec
			# Run test (watching changes)
			$ guard
			
## Project Structure
* __/app__ - Main project folder for holding the app's main logic
	* __assets__ - All css, js, static images go here, rails will monitor all files in this folders and automatic serve
	* __controllers__ - Controllers for the app, all logic to handle request from client go here
		* __front__ - Controllers for the front part 
		* __admin__ - Controllers for the admin part
			* _base_controller_ - Base controller for all controllers in Admin namespace
			* ... 
		* _application_controller.rb_ - Main controller
	* __views__ - Views files, all html that render to the client go here
		*__front__ - Views file for controllers in namespace Front 
			* __services__ - Views file for controller _Front::ServicesController_
			* ...
		*__admin__ - Views file for controllers in namespace Admin
	* __helpers__ - Helpers functions for use in views, each controller will have its respective helper
		*__front__ 
		*__admin__ 
		*_application_helper.rb_ - Main helper for use in all views
	* __models__ - ActiveRecord models files, each models => a table in the dtabase
	* __uploaders__
		*_image_uploader.rb - Carrierwave uploader class, handle uploading image
	* __mailers__ - Not using at this time
* __/bin__ - Hold projects and gems's binstubs (rake, rails, bundle, rspec...)
* __/config__ - Main project configuration
	* __deploy__ - Capistrano deploy settings for each environment
	* __environments__ - Hold settings specific for each environments
	* __initializers__ - Hold initials script that will be run when app starts
	* __locales__ - Hold locales files, define new locales by adding new .yml file in this folder
	* _routes.rb_ - Manage all routes in the app, map route to controller actions
	* _deploy.rb_ - Capistrano deployment script, defines capistrano tasks
	* _application.rb_ - Default settings
	* _settings.ym_ - Our custome settings go here
	* ... (Other files not importaint or not in use at this times)
* __/db__ - Hold all database related stuffs, migrations, seeds
	* __migrate__ - App's migration files are here
	* _schema.rb_ - Auto generated by rails, track all changes to DB
	* _seeds.rb_ - Default data to seed to DB
* __/lib__ - Custom library to use in the app
	* _tasks_ - Custom tasks to use with Rake
	* ...
*__/log__
*__/public__ - Public folders, anything that need to display public go here (imaages, static html...)
* __/spec__ - Tests
* __/tmp__ - Temporary things
* __/vendor__ - 3rd party stuffs
	* __assets__ - 3rd party library's asset, Asset Pipeline will also monitor this folder
* _Capfile_ - Capistrano setting
* _Guardfile_ - Guard setting
* _Gemfile_ - Define project's gem dependencies
* ...

## Workflow
### Development
* Main development branch is __develop__. Branch __master__ is used for deployment (in development can also use __develop__ for deployment)
* When working in a new feature create a new branch __feature_name__

			$ git checkout -b feature_name
			
* After finishing working in this feature, change back to __develop__, pull any update, merge the feature branch and push to remote repo
			
			$ git checkout develop
			$ git pull 
			$ git merge feature_name
			
* When development a feature_branh, if you want to pull change from the remote repo, use rebase (need revise)

			$ git checkout develop
			$ git pull
			$ git checkout feature_name
			$ git rebase develop	
			
* If there is some changes to the database, migrate the data
			
			$ rake db:migrate
			
### Deployment
* Check Caphistrano settings in those files and folder ```Capfile```, ```config/deploy.rb```, ```config/deploy```
* Use the following command to deploy (can choose the branch to deploy)
		
			$ cap staging deploy # only stating environment is enabled now
				 